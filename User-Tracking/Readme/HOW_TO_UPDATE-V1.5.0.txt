Contribution:  User Tracking
Version:  V.1.4.2

Designed for: Zen Cart v1.5 Release
Converted into Zen by: Dave Kennelly dave@open-operations.com
Updated by: mc12345678
License: under the GPL - See attached License for info.
Support:  Only given via the forums, please. http://www.zen-cart.com/forum/showthread.php?t=35081

========================================================

UPDATED 06/24/2013

Identified that IE 7 implementation of OnChange for hide/show spiders did not work as expected.  Changed command to OnClick to be loaded for the radio button that would perform the next action.  (I.e., when spiders are hidden, clicking on Hide spiders will now do nothing, while clicking on Show Spiders will reload the page and show the data collected from a visit by a spider.)
Added notification/observer events instead of simply using function calls.  The actions are still dependent on the footer(s) (requires only modifying one footer file for each of the store and the admin versus attempting to identify every possible header file/header event to observe.)  The observers are not required to be used (I.e., no change to the template files is required to continue use after updating the other files.)
Incorporated text that was hard coded in the admin area into the language file.  
Added display of Back to Today or Forward to Today if selected date is 2 or more days away from the date at the time the php code is run.
Updated the Readme's to try to incorporate the history of previous updates, to minimize the number of files, and to capture the recent changes.

UPDATING INSTRUCTIONS:

Similar updating instructions as previous for updating from earlier Zen Cart version, if updating from Version 1.4.0 or 1.4.1 of User Tracking, then need to 
replace/update the following files:
admin/user_tracking.php 
admin/languages/english/user_tracking.php
admin/languages/farsi/user_tracking.php

Added the following files:
includes/auto_loaders/config.user_tracking.php
includes/classes/observers/class.user_tracking.php
admin/includes/auto_loaders/config.user_tracking.php
admin/includes/classes/class.user_tracking.php

The above added files support using the notify/observer events. If not incorporating the following changes, then those four files may be deleted without negative impact to your cart.  To update to using the notify/observer events, modify the line of code in each of the following two files from:
file:
/includes/templates/ YOUR TEMPLATE /common/tpl_footer.php
from code:
<?php if (ZEN_CONFIG_USER_TRACKING == 'true') { zen_update_user_tracking(); } ?>
to code:
<?php $zco_notifier->notify('NOTIFY_FOOTER_END'); ?>

file:
/admin/includes/footer.php
from code:
<?php if (ADMIN_CONFIG_USER_TRACKING == 'true') { zen_update_user_tracking(); } ?>
to code:
<?php $zco_notifier->notify('NOTIFY_ADMIN_FOOTER_END'); ?>

========================================================

UPDATED 06/15/2013

Added ability to hide/show spider visits using the spiders.txt file of Zen Cart.  Default view is to hide spider visits.
Modified the information shown at the bottom of the view to show the number of users and number of bots/spiders that have visited.  This spider/bot information will show whether the actual visit is or is not shown.  Also incorporated modifications published in the Thread related to display of the Idle time of a visitor.  (Previous calculations lead to incorrect display depending on timezone.)

UPDATING INSTRUCTIONS:

Similar updating instructions as previous for updating from earlier Zen Cart version, if updating from Version 1.4.0 of User Tracking, then need to only replace/update the admin/user_tracking.php file.

========================================================

UPDATED: 07/28/2011 - V 1.5.0 - Install Instructions The Same
knuckle-101 - Host 99 http://www.host-99.com/- Donate to the ZenCart Team

http://www.zen-cart.com/index.php?main_page=infopages&pages_id=14

========================================================

UPDATED 07/28/2011

Removed admin --> includes --> boxes (Entire Folder and Sub Folders and files)
SQL Added for Dropdown Link Under Tools Section

UPDATING INSTRUCTIONS:

If updating from previous versions 1.3.9h etc. Remove the following files from the admin for V 1.5.0 new navigation method

admin --> includes --> boxes --> extra_boxes --> user_tracking_tools_dhtml.php


Enjoy....

========================================================
assembled: reza:02/15/2007, 
----------------
I have not changed any thing in this contribution. when I got problem after installation of user tracker version 1.3.6 on zen 1.3.7 and reading all comments of the forum, I found that most of the peoples got the same problems due to the separation of original package and upgraded package. for This I decided to put all together for zen 1.3.7.

with thanks to Jeff and Woodymon for their supports in the forum. please address your donations to them. 

========================================================

User Tracking v.1.3.6.2 (by JeffD) (UPDATE from v.1.3.6.1) 
Packaged by Woodymon 02-13-07

Regards to changes in User Tracking 1.3.6.2 120406 (JeffD) (Dec. 04, 2006), since 1.3.6.2 was not a regular release I am only including in this attachment changes from previous version: two changed files php plus the SQL patch and the readme.txt. I am hoping JeffD will be back with a full fileset User Tracking update in the future.

I'm running User Tracking v.1.3.6.2 (by JeffD) on Zen Cart 1.37 shop and it is working well. YMMV on other versions of Zen Cart.

BE SURE TO READ THE README!!!! No warranties implied. If you are not sure how to install this then best to stay with previous version.

REPEAT: ONLY the CHANGED User Tracking v.1.3.6.2 files are in this attachment. You will need JeffD's previous version 1.3.6.1 User Tracking installed for this to be useful to you.

Please post questions to the User Tracking mod support thread:
http://www.zen-cart.com/forum/showthread.php?t=35081


UPDATE INSTRUCTIONS:

If you have the previous version of User Tracking 1.3.6.1 installed then, besides updating your shop with the two new php files listed below, you only need to run following SQL patch (and not the full SQL patch file included in this attachment):

[code]INSERT INTO configuration VALUES ('', 'User Tracking (Show Product Category when tracking product clicks)', 'ZEN_CONFIG_SHOW_USER_TRACKING_CATEGORY', 'true', 'Show Product Category when tracking product clicks', 999, 60, '2006-12-05 11:19:26', '2006-12-05 21:20:07', NULL, 'zen_cfg_select_option(array(''true'', ''false''),');[/code]

Add your table prefix as required. (e.g. zen_configuration)


FILES INCLUDED (with changes from previous version):

readme.txt
user_tracking.sql

\includes\functions\extra_functions\
user_tracking.php

\admin\includes\functions\extra_functions\
user_tracking.php

--
FILES NOT INCLUDED (no changes from previous version):

\includes\extra_datafiles\
user_tracking_database_tables.php

\admin\
user_tracking.php
user_tracking_config.php

\admin\images\flags\
*.*

\admin\includes\
GeoIP.dat
geoip.inc

\admin\includes\boxes\extra_boxes\
user_tracking_tools_dhtml.php

\admin\includes\extra_datafiles\
user_tracking_database_tables.php

\admin\includes\languages\english\
user_tracking.php
user_tracking_config.php

{end}

----------------
Updated: JTD:11/27/06 - jeffdripps@isegames.com

Modified the user_tracking.sql by extending the size of the last_page_url field from 64 characters to 128 characters as this was previously too short and would often truncate URL link data. 

Truncated the session_id field from 128 characters to 32 characters as this was wasted space.

Below is the commands necessary for the sql patch tool to alter the table to the new format described in the user_tracking.sql and described above:

ALTER TABLE `user_tracking` CHANGE `session_id` `session_id` VARCHAR(32); 
ALTER TABLE `user_tracking` CHANGE `last_page_url` `last_page_url` VARCHAR(128); 
ALTER TABLE `user_tracking` ADD `customers_host_address` varchar(64) NOT NULL;


Changed the script itself into a form and added a popup date selection menu so you can select a specific date to begin the listing.

Fixed the functions to work with sql 5.x and for longer last_page_url field writes.

Added a missing country flag or two.

Included the latest GeoIP.dat file.

Updated language defines for the popup additions.

History:
updated: 02/15/2007- assembling upgraded user tracking 1.3.6.2 with the original 1.3.6
Updated: 11/28/06 - fixed omission and errors in sql.
Updated: 11/29/06 - Added customers_host_address field support
Updated: 11/30/06 - Revised the report query and listing to begin at midnight on the requested day rather than (the current time - 24 hours) as was the case previously. This just seems more useful and intuitive.
Updated: 12/01/06 - Added Support for displaying product name, (borrowed from Pinghead version) as per Woody's suggestion.
Updated: 12/01/06 - Added Support for recording all page titles when tracking admin.
Updated: 12/04/06 - Added Configuration key and code for disabling category output when tracking product clicks.


Please let me know if you find bugs or omissions?

Thanks,
Jeff
jeffdripps@isegames.com

==========================================================

WHAT DOES THIS MODULE DO?

This module tracks your visitors hits on your site and displays pages visited by user session in admin
========================================================

History:
12/12/2004 - Initial Release
07/28/2011 - Updated SQL for Box Links 


========================================================

FILES TO OVER-WRITE
none

========================================================

File Modifications: 2

add the following to the end of /includes/templates/ YOUR TEMPLATE /common/tpl_footer.php

<?php if (ZEN_CONFIG_USER_TRACKING == 'true') { zen_update_user_tracking(); } ?>

add if you want to track admin pages viewed add the following to the end of /admin/includes/footer.php

<?php if (ADMIN_CONFIG_USER_TRACKING == 'true') { zen_update_user_tracking(); } ?>

========================================================

Database Modifications:

A new database table needs to be created to store your site visits.

========================================================

INSTALLATION:

All files are arranged in the correct Zen Cart v1.2.x - 1.3.x structure.
Just upload to your server as they are without any editing required.
upload the included user_tracking.sql using the Zen-cart SQL Patches Tool
Make the file modifications above.

========================================================

USE:
Admin/Tools/User Tracking displays your users visits
Admin/Tools/User Manager Config allows some user manager configuration

